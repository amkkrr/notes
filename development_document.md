# 笔记应用开发文档

## 项目概述

本项目是一个基于 Web 技术开发的笔记应用，使用 Dexie.js 作为本地数据库，并通过 PWA + TWA 技术封装为安卓原生应用。

## 项目架构

### 架构设计原则

本项目采用低耦合架构设计，主要体现在以下几个方面：

1. 模块化设计
   - 每个功能模块独立封装
   - 模块之间通过接口通信
   - 避免直接依赖，使用依赖注入
   - 各模块可独立测试和部署

2. 数据流设计
   - 采用单向数据流
   - 状态管理与UI完全分离
   - 通过发布订阅模式实现模块间通信
   - 避免模块间直接数据传递

3. 接口设计
   - 定义清晰的模块接口
   - 隐藏内部实现细节
   - 提供统一的错误处理机制
   - 版本化接口设计

4. 存储设计
   - 数据访问层统一封装
   - 业务逻辑与数据操作分离
   - 提供抽象的存储接口
   - 支持多种存储方式切换

### 目录结构
```
notes-app/
├── src/
│   ├── assets/          # 静态资源
│   ├── components/      # 通用组件
│   │   ├── Editor/      # 编辑器组件
│   │   ├── NoteList/    # 笔记列表组件
│   │   └── Category/    # 分类管理组件
│   ├── pages/          # 页面组件
│   ├── services/       # 服务层
│   │   ├── db.js       # 数据库服务
│   │   ├── sync.js     # 同步服务
│   │   └── export.js   # 导出服务
│   ├── utils/          # 工具函数
│   ├── styles/         # 样式文件
│   └── app.js         # 应用入口
├── public/
│   ├── index.html
│   ├── manifest.json
│   └── service-worker.js
├── scripts/           # 构建脚本
└── docs/             # 项目文档
```

## 技术栈

- 前端框架：HTML5 + CSS3 + JavaScript
- 数据库：Dexie.js (IndexedDB 封装)
- 打包方案：PWA + TWA
- 开发工具：VS Code、Android Studio
- 目标平台：Web App

## 数据库设计

### 数据表结构

#### notes 表
- id: 自增主键
- title: 笔记标题
- content: 笔记内容
- created: 创建时间
- modified: 最后修改时间
- categoryId: 分类ID
- tags: 标签数组
- isFavorite: 是否收藏
- isArchived: 是否归档

#### categories 表
- id: 自增主键
- name: 分类名称
- color: 分类颜色

## 功能模块

### 主要功能
1. 笔记编辑器
   - 基于 Prosemirror 的富文本编辑
   - 实时保存
   - 支持多种格式

2. 搜索功能
   - 基于索引的全文搜索
   - 关键词分词处理
   - 实时搜索结果

3. 数据导入导出
   - JSON 格式导出
   - 版本兼容处理
   - 批量导入功能

4. 多设备同步
   - 基于时间戳的同步策略
   - 冲突处理
   - 离线支持

## 错误处理

### 错误类型
1. 数据库错误（DatabaseError）
2. 同步错误（SyncError）
3. 验证错误（ValidationError）

### 错误处理策略
- 错误日志记录
- 用户友好提示
- 自动重试机制

## 性能优化

### 资源优化
- 使用 WebP 图片格式
- 启用 GZIP 压缩
- 实现资源预加载

### 数据库优化
- 使用适当的索引
- 批量操作优化
- 大文本分片存储

### 离线优化
- 实现渐进式加载
- 优化缓存策略
- 预缓存关键资源

## 开发规范

### 代码规范
- 使用 ESLint 进行代码检查
- 遵循 Git 提交规范
- 编写单元测试

### 文档规范
- 及时更新 API 文档
- 编写代码注释
- 记录重要决策

### 版本控制
- 遵循语义化版本
- 维护更新日志
- 做好分支管理

## 注意事项

### 数据库相关
- 定期备份数据
- 处理并发访问
- 注意数据迁移

### PWA 相关
- 确保 HTTPS 配置
- 处理离线状态
- 注意缓存策略

### TWA 相关
- 验证数字资产链接
- 处理深层链接
- 注意应用签名